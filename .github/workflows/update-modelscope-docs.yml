jobs:
  update-docs:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code and disable default credential storage
      - name: Checkout repository code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
          persist-credentials: false # Critical! Prevents subsequent authentication conflicts

      # 2. Configure Git user information
      - name: Setup Git user
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # 3. (Optional but recommended) Reconfigure the remote repository URL with authentication token as per the article
      - name: Authenticate Git remote
        run: |
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}

      # --- Your original business logic steps (Python setup, file download, etc.) ---
      - name: Set up Python environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Python dependencies
        run: |
          pip install -r requirements.txt

      - name: Download ModelScope documentation
        id: download
        run: |
          cd "$GITHUB_WORKSPACE"
          python docs/scripts/download_readmes.py
        continue-on-error: true
      # --- End of business logic steps ---

      # 4. Use peter-evans/create-pull-request to create the PR
      # This Action will automatically detect workspace changes, commit, create a branch, and push
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          # Commit message
          commit-message: 'Auto-update ModelScope documentation [$(date +''%Y-%m-%d %H:%M'')]'
          # Branch settings
          branch: 'update/modelscope-docs-$(date +''%Y%m%d-%H%M%S'')'
          delete-branch: true
          # PR settings
          title: 'ðŸ“š ModelScope Documentation Update - $(date +''%Y-%m-%d'')'
          body-path: 'docs/flagrelease_en/model_readmes/download_report_*.txt' # Note: This needs to match your report filename pattern
          # Base branch and labels
          base: 'main'
          labels: 'documentation, auto-update, modelscope'
          draft: false